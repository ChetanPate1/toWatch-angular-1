function config(e,t){e.state("home",{url:"/most-popular",templateUrl:"home/home.html",controller:"HomeController",controllerAs:"HomeCtrl"}).state("signin",{url:"/signin",templateUrl:"signin/sign.html",controller:"SigninController",controllerAs:"SigninCtrl"}).state("watchlist",{url:"/watchlist",templateUrl:"watchlist/watchlist.html",controller:"WatchlistController",controllerAs:"WatchlistCtrl",resolve:{currentAuth:["firebaseAuth",function(e){return e.$requireSignIn()}]}}).state("rewatchlist",{url:"/rewatchlist",templateUrl:"rewatchlist/rewatchlist.html",controller:"RewatchlistController",controllerAs:"RewatchlistCtrl",resolve:{currentAuth:["firebaseAuth",function(e){return e.$requireSignIn()}]}}).state("my-shows",{url:"/my-shows",templateUrl:"my-shows/my-shows.html",controller:"MyShowsController",controllerAs:"MyShowsCtrl",resolve:{currentAuth:["firebaseAuth",function(e){return e.$requireSignIn()}]}}),t.otherwise("most-popular")}function runBlock(e,t){e.$on("$stateChangeError",function(e,n,o,s,a,r){"AUTH_REQUIRED"===r&&t.go("signin")})}function HomeController(e){var t=this;t.mostPopular={},e.getMostPopular().then(function(e){t.mostPopular=e})}function MyShowsController(e,t,n,o,s){function a(e){u.foundShows=[],u.sendStatus.loader=!0,n.getShow(e).then(function(n){n.seasons&&(n.requestData=e,s(function(){c(n.series,"added to My Shows"),t.save(l,n),u.series=""},2e3)),u.sendStatus.disableButton=!1,u.sendStatus.loader=!1})}function r(){var e=u.series;u.series&&(u.sendStatus.disableButton=!0,u.sendStatus.loader=!0,i(e)?(u.series="",u.sendStatus.disableButton=!1,u.sendStatus.loader=!1):(e=o.spacesToDashes(e),n.search(e).then(function(t){o.objSize(t)<1?a(e):u.foundShows=t}),u.sendStatus.disableButton=!1,u.sendStatus.loader=!1))}function i(e){var t=u.shows,n=0,o=!1;for(n=0;n<t.length;n++)t[n].series.toLowerCase()==e.toLowerCase()&&(o=!0);return o}function c(e,t){u.toast.content=e,u.toast.action=t,u.toast.show=!0,s(function(){u.toast.show=!1},3e3)}var u=this,l="shows/"+e.uid;u.uid=e.uid,u.foundShows=[],u.sendStatus={disableButton:!1,loader:!1,validation:""},u.toast={content:"",action:"",show:!1},u.shows=t.getByRef(l),u.add=a,u.find=r,u.showToast=c}function RewatchlistController(e,t,n,o,s){function a(){u.addButtonDisabled=!0;var e=u.shows.$getRecord(u.seriesRef).series,o={showId:u.seriesRef,on:{season:"1",episode:"1"},show:s.initRewatchlist(u.seriesRef,u.shows)};c(e,"added to Rewatch list"),t.save(l,o),u.seriesRef="",n(function(){u.addButtonDisabled=!1,u.popupOpen=!1},2e3)}function r(){u.popupOpen=!0}function i(e,t){return!!u.shows.$getRecord(e)||(u.rewatch.$remove(t),!1)}function c(e,t){u.toast.content=e,u.toast.action=t,u.toast.show=!0,n(function(){u.toast.show=!1},3e3)}var u=this,l="rewatch/"+e.uid,h="shows/"+e.uid;u.popupOpen=!1,u.toast={content:"",action:"",show:!1},u.addButtonDisabled=!1,u.rewatch=t.getByRef(l),u.shows=t.getByRef(h),u.add=a,u.openPopup=r,u.checkShowExist=i,u.showToast=c}function episodateApi(e,t,n){function o(){return e({method:"GET",url:"https://www.episodate.com/api/most-popular?page=1"}).then(function(e){return e.data.tv_shows})}function s(n){return e({method:"GET",url:"https://www.episodate.com/api/show-details?q="+n}).then(function(e){return 0!==t.objSize(e.data.tvShow.episodes)&&a(e.data.tvShow)})}function a(e){var n=e.episodes,o={},s=t.objSize(n)-1,a=1,r=1,i=0,c={};for(c.seasons=[],c.series=e.name,c.imgSrc=e.image_path,c.imgSrcSm=e.image_thumbnail_path,c.status=e.status,c.lastUpdated=(new Date).getTime(),o["season_"+a]={},i;i<=s&&(o["season_"+a][r]={name:n[i].name,number:n[i].episode,airDate:t.dateToMs(n[i].air_date)},!(i>s-1));i++)n[i+1].season===a?r++:(r=1,a++,o["season_"+a]={}),c.seasons=o;return c}function r(t){return e({method:"GET",url:"https://www.episodate.com/api/search?q="+t}).then(function(e){return e.data.tv_shows})}return{getMostPopular:o,getShow:s,generateSeasons:a,search:r}}function firebaseArray(e){function t(t,n){var t=firebase.database().ref(t);return e(t).$add(n)}function n(t){var t=firebase.database().ref(t);return e(t)}return{save:t,getByRef:n}}function firebaseAuth(e){return e()}function helperFunctions(){function e(e){var t=0;for(var n in e){if(!e.hasOwnProperty(n))break;++t}return t}function t(e){return e=e.toLowerCase(),e.replace(/\s+/g,"-")}function n(e){return new Date(e).getTime()}function o(e,t){e=parseInt(e);var n=Math.abs(e-a)/1e3;return Math.floor(n/86400)>t}var s={objSize:e,spacesToDashes:t,dateToMs:n,hasDaysPast:o},a=(new Date).getTime();return s}function seriesInitService(e,t){function n(e,n){var o={},s=n.$getRecord(e.showId),a=t.objSize(s.seasons),r=parseInt(e.on.episode),i=parseInt(e.on.season),c=i;t.objSize(s.seasons["season_"+i]);for(c;c<=a;c++){seasonsSize=t.objSize(s.seasons["season_"+c]),o["season_"+c]=s.seasons["season_"+c],o["season_"+c][0]=c;for(var u=1;u<=seasonsSize;u++)o["season_"+c][u].watched=!1,u<r&&c==i&&(o["season_"+c][u].watched=!0)}return o}function o(e,n){var o=n.$getRecord(e).seasons,s=t.objSize(o),a=1,r=1;for(a;a<=s;a++)for(seasonsSize=t.objSize(o["season_"+a]),r;r<=seasonsSize;r++)o["season_"+a][r].watched=!1;return o}return{initWatchlist:n,initRewatchlist:o}}function SigninController(e,t,n){function o(){i.email,i.password;i.email&&i.password&&e.$signInWithEmailAndPassword(i.email,i.password).then(function(e){t.go("my-shows")}).catch(function(e){r(e)})}function s(){i.email,i.password;e.$createUserWithEmailAndPassword(i.email,i.password).then(function(e){t.go("shows")}).catch(function(e){r(e)})}function a(){e.$signInAnonymously()}function r(e){i.validation.show=!0,"auth/wrong-password"===e.code&&(i.validation.message="Incorrect password"),"auth/user-not-found"===e.code&&(i.validation.message="User does not exist"),"auth/email-already-in-use"===e.code&&(i.validation.message="User already exists"),n(function(){i.validation.show=!1},3e3)}var i=this;i.validation={message:"Something went wrong",show:!1},i.login=o,i.signup=s,i.signInAnonymously=a}function WatchlistController(e,t,n,o,s,a){function r(){var e=p.shows.$getRecord(p.seriesRef).series,n={lastUpdated:m,upToDate:!1,showId:p.seriesRef,on:{season:p.season,episode:p.episode},unwatched:{}};n.unwatched=a.initWatchlist(n,p.shows),t.save(w,n),d(e,"added to Watch list"),p.seriesRef="",p.season="",p.episode="",p.popupOpen=!1}function i(e){var t=1,n=p.shows.$getRecord(e.showId),s=o.objSize(n.seasons),a=n.seasons["season_"+s],r=o.objSize(a);for(t;t<=r;t++)if(a[t].airDate-m>0)return a[t].airDate}function c(e){return(e=parseInt(e))-m<0}function u(){p.popupOpen=!0}function l(e){var t=0,n=!1;for(t=0;t<p.watchlist.length;t++)p.watchlist[t].showId==e&&(n=!0);return n}function h(e,t){return!!p.shows.$getRecord(e)||(p.watchlist.$remove(t),!1)}function d(e,t){p.toast.content=e,p.toast.action=t,p.toast.show=!0,n(function(){p.toast.show=!1},3e3)}var p=this,f="shows/"+e.uid,w="watchlist/"+e.uid,m=(new Date).getTime();p.popupOpen=!1,p.toast={content:"",show:!1},p.watchlist=t.getByRef(w),p.shows=t.getByRef(f),p.add=r,p.nextAired=i,p.checkAired=c,p.openPopup=u,p.seriesAlreadyAdded=l,p.checkShowExist=h,p.showToast=d}function countdownTimer(e,t){function n(t,n){function o(e,t){var n=Math.abs(e-t);if(e-t<0||!e)return[0,0,0,0];var o=Math.floor(n/a.day);n-=o*a.day;var s=Math.floor(n/a.hour)%a.hour;n-=s*a.hour;var r=Math.floor(n/a.minute)%a.hour;return n-=r*a.minute,[o,s,r,Math.floor(n)]}function s(e){var t={},n=["day","hour","min","sec"],o=0;for(o;o<4;o++)t[n[o].charAt(0)]={name:n[o],val:"0"+e[o]},e[o]>1&&e[o]<10&&(t[n[o].charAt(0)]={name:n[o]+"s",val:"0"+e[o]}),e[o]>9&&(t[n[o].charAt(0)]={name:n[o]+"s",val:""+e[o]});return t}var a={now:function(){return(new Date).getTime()/1e3},future:t.to/1e3,day:86400,hour:3600,minute:60};e(function(){t.counter=s(o(a.future,a.now()))},1e3)}return{link:n,templateUrl:"components/countdown-timer/countdown-timer.html",restrict:"E",scope:{to:"="}}}function frostGlass(){return{templateUrl:"components/frost-glass/frost-glass.html",restrict:"E",transclude:!0,scope:{imgsrc:"="}}}function NavigationBarController(e,t){function n(){"close"==close&&(a.open=!1),a.open=!a.open}function o(){return e.$getAuth()}function s(){e.$signOut(),t.go("home")}var a=this;a.open=!1,a.toggleOpen=n,a.userSignedIn=o,a.logout=s}function navigationBar(){return{templateUrl:"components/navigation-bar/navigation-bar.html",restrict:"E",controller:"NavigationBarController",controllerAs:"NavbarCtrl"}}function noContent(){return{templateUrl:"components/no-content/no-content.html",restrict:"E",scope:{condition:"=",message:"="}}}function seasonInfo(e){function t(t){function n(e){t[e]=!t[e]}function o(e){t.tabActive=e}function s(e){return t.tabActive==e}function a(e,n,o,s){var a=parseInt(o.airDate),r=parseInt(e[n].on.episode),c=s===r||s===r-1&&t.tabActive.toString()==e[n].on.season;Math.abs(a-u)/1e3<0||!c||(o.watched=!o.watched,i(e[n].show,e,n),e.$save(n))}function r(e){return(e=parseInt(e))-u<0}function i(t,n,o){for(var s=(parseInt(n[o].on.episode),parseInt(n[o].on.season)),a="season_"+s,r=e.objSize(t[a]),i=0,c=1;c<=r;c++)1==t[a][c].watched&&i++,i==r&&(s++,i=0);n[o].on.episode=(i+1).toString(),n[o].on.season=s.toString()}function c(e,t){return e.length>t?e.substring(0,t)+"...":e}var u=(new Date).getTime();t.open=!1,t.deleteOpen=!1,t.toggleOpen=n,t.tabActive=t.currentseason,t.tabSelect=o,t.isTabSelected=s,t.save=a,t.hasAired=r,t.currentSeason=i,t.limitLength=c}return{link:t,templateUrl:"components/season-info/season-info.html",restrict:"E",scope:{seasons:"=",currentseason:"=",rewatchobj:"=",index:"="}}}function seasonTabs(e){function t(t){function n(e){t[e]=!t[e]}function o(e){t.tabActive=e}function s(e){return t.tabActive==e}function a(e,n,o,s){var a=parseInt(o.airDate),r=parseInt(e[n].on.episode),i=s===r||s===r-1&&t.tabActive.toString()==e[n].on.season;Math.abs(a-l)/1e3<0||!i||(o.watched=!o.watched,c(e[n].show,e,n),e.$save(n))}function r(e){if(e){e=parseInt(e);var t=Math.abs(e-l)/1e3,n={aired:e-l<0};return e-l<0?(n.by="-"+Math.ceil(t/86400)+" days",Math.ceil(t/86400)>30&&(n.by="aired")):n.by="not aired",n}}function i(e){return(e=parseInt(e))-l<0}function c(t,n,o){for(var s=(parseInt(n[o].on.episode),parseInt(n[o].on.season)),a="season_"+s,r=e.objSize(t[a]),i=0,c=1;c<=r;c++)1==t[a][c].watched&&i++,i==r&&(s++,i=0);n[o].on.episode=(i+1).toString(),n[o].on.season=s.toString()}function u(e,t){return e.length>t?e.substring(0,t)+"...":e}var l=(new Date).getTime();t.open=!1,t.deleteOpen=!1,t.toggleOpen=n,t.tabActive=t.currentseason,t.tabSelect=o,t.isTabSelected=s,t.save=a,t.hasAired=i,t.currentSeason=c,t.limitLength=u,t.aired=r}return{link:t,templateUrl:"components/season-tabs/season-tabs.html",restrict:"E",scope:{open:"=",seasons:"=",currentseason:"="}}}function showCard(e,t,n){function o(n){var o=(new Date).getTime();if(n.deleteable=!0,n.deleteOpen=!1,void 0==n.index)return void(n.deleteable=!1);!function(n,s){var a=n[s];"Running"===a.status&&t.hasDaysPast(a.lastUpdated,7)&&t.hasDaysPast(a.lastUpdated,3)&&e.getShow(a.requestData).then(function(e){e&&(a.lastUpdated=o,a.series=e.series,a.imgSrc=e.imgSrc,a.imgSrcSm=e.imgSrcSm,a.status=e.status,a.seasons=e.seasons,n.$save(s))})}(n.shows,n.index)}return{link:o,templateUrl:"components/show-card/show-card.html",restrict:"E",scope:{heading:"=",imgsrc:"=",shows:"=?",index:"=?"}}}function toast(){return{templateUrl:"components/toast/toast.html",restrict:"E",scope:{content:"=",action:"=",show:"="}}}function watchlistCard(e,t){function n(n){function o(e){n[e]=!n[e]}function s(e,t,o,s,a){var i=parseInt(s.airDate),c=parseInt(e[t].on.episode),u=n.tabActive.toString()==e[t].on.season,l=a==c||a==c-1&&u;i-d>0||!l||(s.watched=!s.watched,r(o,e,t),e.$save(t))}function a(e){if(e){e=parseInt(e);var t=Math.abs(e-d)/1e3,n={aired:e-d<0};return e-d<0?(n.by="-"+Math.ceil(t/86400)+" days",Math.ceil(t/86400)>30&&(n.by="aired")):n.by="not aired",n}}function r(t,n,o){var s,a=parseInt(n[o].on.season),r=a+1,i=void 0==n[o].unwatched["season_"+r],c=e.objSize(t)+a,u=0,l=1,h=0,d=1,p=t["season_"+a];for(a;a<c;a++){for(s=t["season_"+a],h=e.objSize(s),l;l<h;l++)s[l].watched&&u++,s[l].watched||(d=u+1);l=1}d==p.length?i?n[o].upToDate=!0:(n[o].on.season=r,n[o].on.episode=1):n[o].on.episode=d}function i(e){n.tabActive=e}function c(e){return n.tabActive==e}function u(e){return(e=parseInt(e))-d<0}function l(e,t){return e.length>t?e.substring(0,t)+"...":e}function h(t,n){var o,n=parseInt(n),s=e.objSize(t)+n,a=0,r=1,i=0;for(n;n<s;n++){for(o=t["season_"+n],i=e.objSize(o),r;r<i;r++)!o[r].watched&&o[r].airDate-d<0&&a++;r=1}return a>0?"-"+a:a}var d=(new Date).getTime();n.deleteOpen=!1,n.open=!1,n.upToDate=!1,n.toggleOpen=o,n.save=s,n.aired=a,n.countWatched=r,n.tabActive=n.currentseason,n.tabSelect=i,n.isTabSelected=c,n.hasAired=u,n.limitLength=l,n.behindCount=h,function(n,o,s){var a=n[o];e.hasDaysPast(a.lastUpdated,3)&&(console.log("update"),a.unwatched=t.initWatchlist(a,s),a.lastUpdated=(new Date).getTime(),n.$save(o))}(n.watchlistobj,n.index,n.shows)}return{link:n,templateUrl:"components/watchlist-card/watchlist-card.html",restrict:"E",transclude:{frostGlass:"frostGlass"},scope:{heading:"=",subheading:"=",details:"=",imgsrc:"=",seasons:"=",currentseason:"=",watchlistobj:"=",index:"=",shows:"="}}}function rewatchCard(){return{templateUrl:"components/rewatch-card/rewatch-card.html",restrict:"E",transclude:{seasonInfo:"seasonInfo",frostGlass:"frostGlass"},scope:{heading:"=",subheading:"=",details:"=",imgsrc:"="}}}angular.module("app",["ui.router","firebase"]),angular.module("app").config(config),config.$inject=["$stateProvider","$urlRouterProvider"],angular.module("app").run(runBlock),runBlock.$inject=["$rootScope","$state"],angular.module("app").controller("HomeController",HomeController),HomeController.$inject=["episodateApi"],angular.module("app").controller("MyShowsController",MyShowsController),MyShowsController.$inject=["currentAuth","firebaseArray","episodateApi","helperFunctions","$timeout"],angular.module("app").controller("RewatchlistController",RewatchlistController),RewatchlistController.$inject=["currentAuth","firebaseArray","$timeout","helperFunctions","seriesInitService"],angular.module("app").service("episodateApi",episodateApi),episodateApi.$inject=["$http","helperFunctions","$timeout"],angular.module("app").factory("firebaseArray",firebaseArray),firebaseArray.$inject=["$firebaseArray"],angular.module("app").factory("firebaseAuth",firebaseAuth),firebaseAuth.$inject=["$firebaseAuth"];var config={apiKey:"AIzaSyBThnFs67ZrJ6J0z6IXkGzT16077IGXk9c",authDomain:"towatch-b9155.firebaseapp.com",databaseURL:"https://towatch-b9155.firebaseio.com",projectId:"towatch-b9155",storageBucket:"towatch-b9155.appspot.com",messagingSenderId:"989986376535"};firebase.initializeApp(config),angular.module("app").factory("helperFunctions",helperFunctions),angular.module("app").factory("seriesInitService",seriesInitService),seriesInitService.$inject=["firebaseArray","helperFunctions"],angular.module("app").controller("SigninController",SigninController),SigninController.$inject=["firebaseAuth","$state","$timeout"],angular.module("app").controller("WatchlistController",WatchlistController),WatchlistController.$inject=["currentAuth","firebaseArray","$timeout","helperFunctions","episodateApi","seriesInitService"],angular.module("app").directive("countdownTimer",countdownTimer),countdownTimer.$inject=["$interval","helperFunctions"],angular.module("app").directive("frostGlass",frostGlass),angular.module("app").controller("NavigationBarController",NavigationBarController),NavigationBarController.$inject=["firebaseAuth","$state"],angular.module("app").directive("navigationBar",navigationBar),angular.module("app").directive("noContent",noContent),angular.module("app").directive("seasonInfo",seasonInfo),seasonInfo.$inject=["helperFunctions"],angular.module("app").directive("seasonTabs",seasonTabs),seasonTabs.$inject=["helperFunctions"],angular.module("app").directive("showCard",showCard),showCard.$inject=["episodateApi","helperFunctions","firebaseArray"],angular.module("app").directive("toast",toast),angular.module("app").directive("watchlistCard",watchlistCard),watchlistCard.$inject=["helperFunctions","seriesInitService"],angular.module("app").directive("rewatchCard",rewatchCard);