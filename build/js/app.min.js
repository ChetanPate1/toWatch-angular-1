function countdownTimer(e,t){function n(t,n){function o(e,t){var n=Math.abs(e-t);if(e-t<0||!e)return[0,0,0,0];var o=Math.floor(n/r.day);n-=o*r.day;var a=Math.floor(n/r.hour)%r.hour;n-=a*r.hour;var s=Math.floor(n/r.minute)%r.hour;return n-=s*r.minute,[o,a,s,Math.floor(n)]}function a(e){var t={},n=["day","hour","min","sec"],o=0;for(o;o<4;o++)t[n[o].charAt(0)]={name:n[o],val:"0"+e[o]},e[o]>1&&e[o]<10&&(t[n[o].charAt(0)]={name:n[o]+"s",val:"0"+e[o]}),e[o]>9&&(t[n[o].charAt(0)]={name:n[o]+"s",val:""+e[o]});return t}var r={now:function(){return(new Date).getTime()/1e3},future:t.to/1e3,day:86400,hour:3600,minute:60};e(function(){t.counter=a(o(r.future,r.now()))},1e3)}return{link:n,templateUrl:"components/countdown-timer/countdown-timer.html",restrict:"E",scope:{to:"="}}}function countdownCard(){return{templateUrl:"components/countdown-card/countdown-card.html",restrict:"E",transclude:!0,scope:{heading:"=",subheading:"=",imgsrc:"=",visible:"="}}}function frostGlass(e){return{templateUrl:"components/frost-glass/frost-glass.html",restrict:"E",transclude:!0,scope:{imgsrc:"="}}}function NavigationBarController(e,t){function n(){"close"==close&&(r.open=!1),r.open=!r.open}function o(){return e.$getAuth()}function a(){e.$signOut(),t.go("home")}var r=this;r.open=!1,r.toggleOpen=n,r.userSignedIn=o,r.logout=a}function navigationBar(){return{templateUrl:"components/navigation-bar/navigation-bar.html",restrict:"E",controller:"NavigationBarController",controllerAs:"NavbarCtrl"}}function rewatchCard(){return{templateUrl:"components/rewatch-card/rewatch-card.html",restrict:"E",transclude:!0,scope:{heading:"=",subheading:"=",details:"=",imgsrc:"=",visible:"="}}}function seasonInfo(e){function t(t){function n(){t.open=!t.open}function o(e){t.tabActive=e}function a(e){return t.tabActive==e}function r(e,n,o,a){var r=parseInt(o.airDate),s=parseInt(e[n].on.episode),c=a===s||a===s-1&&t.tabActive.toString()==e[n].on.season;Math.abs(r-u)/1e3<0||!c||(o.watched=!o.watched,i(e[n].show,e,n),e.$save(n))}function s(e){return(e=parseInt(e))-u<0}function i(t,n,o){for(var a=(parseInt(n[o].on.episode),parseInt(n[o].on.season)),r="season_"+a,s=e.objSize(t[r]),i=0,c=1;c<=s;c++)1==t[r][c].watched&&i++,i==s&&(a++,i=0);n[o].on.episode=(i+1).toString(),n[o].on.season=a.toString()}function c(e,t){return e.length>t?e.substring(0,t)+"...":e}var u=(new Date).getTime();t.open=!1,t.deleteOpen=!1,t.toggleOpen=n,t.tabActive=t.currentseason,t.tabSelect=o,t.isTabSelected=a,t.save=r,t.hasAired=s,t.currentSeason=i,t.limitLength=c}return{link:t,templateUrl:"components/season-info/season-info.html",restrict:"E",scope:{seasons:"=",currentseason:"=",rewatchobj:"=",index:"="}}}function seasonTabs(e){function t(t){function n(){t.open=!t.open}function o(e){t.tabActive=e}function a(e){return t.tabActive==e}function r(e,n,o,a){var r=parseInt(o.airDate),s=parseInt(e[n].on.episode),i=a===s||a===s-1&&t.tabActive.toString()==e[n].on.season;Math.abs(r-l)/1e3<0||!i||(o.watched=!o.watched,c(e[n].show,e,n),e.$save(n))}function s(e){if(e){e=parseInt(e);var t=Math.abs(e-l)/1e3,n={aired:e-l<0};return e-l<0?(n.by="-"+Math.ceil(t/86400)+" days",Math.ceil(t/86400)>30&&(n.by="aired")):n.by="not aired",n}}function i(e){return(e=parseInt(e))-l<0}function c(t,n,o){for(var a=(parseInt(n[o].on.episode),parseInt(n[o].on.season)),r="season_"+a,s=e.objSize(t[r]),i=0,c=1;c<=s;c++)1==t[r][c].watched&&i++,i==s&&(a++,i=0);n[o].on.episode=(i+1).toString(),n[o].on.season=a.toString()}function u(e,t){return e.length>t?e.substring(0,t)+"...":e}var l=(new Date).getTime();t.open=!1,t.deleteOpen=!1,t.toggleOpen=n,t.tabActive=t.currentseason,t.tabSelect=o,t.isTabSelected=a,t.save=r,t.hasAired=i,t.currentSeason=c,t.limitLength=u,t.aired=s}return{link:t,templateUrl:"components/season-tabs/season-tabs.html",restrict:"E",scope:{open:"=",seasons:"=",currentseason:"="}}}function showsCountdownCard(){function e(e){function t(){e.open=!e.open}function n(e,t,n,o,r){var i=parseInt(o.airDate),c=parseInt(e[t].on.episode),u=r==c||r==c-1;Math.abs(i-s)/1e3<0||!u||(o.watched=!o.watched,a(n,e,t),e.$save(t))}function o(e){if(e){e=parseInt(e);var t=Math.abs(e-s)/1e3,n={aired:e-s<0};return e-s<0?(n.by="-"+Math.ceil(t/86400)+" days",Math.ceil(t/86400)>30&&(n.by="aired")):n.by="not aired",n}}function a(e,t,n){var o=1,a=e.length-1,r=parseInt(t[n].on.season)+1,s=void 0==t[n].on.season["season_"+r];for(o;o<=a&&e[o].watched;o++);o>a&&(s?t[n].upToDate=!0:(t[n].on.season=r,t[n].on.episode=1)),t[n].on.episode=o}function r(e){var t=1,n=e.length-1,o=0;for(t;t<=n;t++)!e[t].watched&&e[t].airDate-s<0&&o++;return o>0?"-"+o:o}var s=(new Date).getTime();e.deleteOpen=!1,e.open=!1,e.upToDate=!1,e.toggleOpen=t,e.save=n,e.aired=o,e.countWatched=a,e.behindCount=r}return{link:e,templateUrl:"components/shows-countdown-card/shows-countdown-card.html",restrict:"E",transclude:!0,scope:{heading:"=",subheading:"=",details:"=",imgsrc:"=",seasoninfo:"=",visible:"=",watchlistobj:"=",index:"="}}}function watchlistCard(e){function t(t){function n(e){t[e]=!t[e]}function o(e,n,o,a,s){var i=parseInt(a.airDate),c=parseInt(e[n].on.episode),u=t.tabActive.toString()==e[n].on.season,l=s==c||s==c-1&&u;console.log("episodeNumber",s,"isOneLessOneMore ",l,"isCurrentTab",u),i-d>0||!l||(a.watched=!a.watched,r(o,e,n),e.$save(n))}function a(e){if(e){e=parseInt(e);var t=Math.abs(e-d)/1e3,n={aired:e-d<0};return e-d<0?(n.by="-"+Math.ceil(t/86400)+" days",Math.ceil(t/86400)>30&&(n.by="aired")):n.by="not aired",n}}function r(t,n,o){var a,r=parseInt(n[o].on.season),s=r+1,i=void 0==n[o].unwatched["season_"+s],c=e.objSize(t)+r,u=0,l=1,d=0,h=1,p=t["season_"+r];for(r;r<c;r++){for(a=t["season_"+r],d=e.objSize(a),l;l<d;l++)a[l].watched&&u++,a[l].watched||(h=u+1);l=1}h==p.length?(n[o].on.season=s,n[o].on.episode=1):n[o].on.episode=h,i&&h==p.length&&(n[o].upToDate=!0)}function s(e){t.tabActive=e}function i(e){return t.tabActive==e}function c(e){return(e=parseInt(e))-d<0}function u(e,t){return e.length>t?e.substring(0,t)+"...":e}function l(t,n){var o,n=parseInt(n),a=e.objSize(t)+n,r=0,s=1,i=0;for(n;n<a;n++){for(o=t["season_"+n],i=e.objSize(o),s;s<i;s++)!o[s].watched&&o[s].airDate-d<0&&r++;s=1}return r>0?"-"+r:r}var d=(new Date).getTime();t.deleteOpen=!1,t.open=!1,t.upToDate=!1,t.toggleOpen=n,t.save=o,t.aired=a,t.countWatched=r,t.tabActive=t.currentseason,t.tabSelect=s,t.isTabSelected=i,t.hasAired=c,t.limitLength=u,t.behindCount=l}return{link:t,templateUrl:"components/watchlist-card/watchlist-card.html",restrict:"E",transclude:{frostGlass:"frostGlass"},scope:{heading:"=",subheading:"=",details:"=",imgsrc:"=",seasons:"=",currentseason:"=",watchlistobj:"=",index:"="}}}function config(e,t){e.state("home",{url:"/home",templateUrl:"home/home.html",resolve:{currentAuth:["firebaseAuth",function(e){return e.$waitForSignIn()}]}}).state("signin",{url:"/signin",templateUrl:"signin/sign.html",controller:"SigninController",controllerAs:"SigninCtrl"}).state("watchlist",{url:"/watchlist",templateUrl:"watchlist/watchlist.html",controller:"WatchlistController",controllerAs:"WatchlistCtrl",resolve:{currentAuth:["firebaseAuth",function(e){return e.$requireSignIn()}]}}).state("rewatch",{url:"/rewatch",templateUrl:"rewatchlist/rewatch.html",controller:"RewatchController",controllerAs:"RewatchCtrl",resolve:{currentAuth:["firebaseAuth",function(e){return e.$requireSignIn()}]}}).state("shows",{url:"/shows",templateUrl:"shows/shows.html",controller:"ShowsController",controllerAs:"ShowsCtrl",resolve:{currentAuth:["firebaseAuth",function(e){return e.$requireSignIn()}]}}),t.otherwise("home")}function runBlock(e,t){e.$on("$stateChangeError",function(e,n,o,a,r,s){"AUTH_REQUIRED"===s&&t.go("signin")})}function RewatchController(e,t,n,o){function a(){var e={showId:s.seriesRef,on:{season:"1",episode:"1"},show:r(s.shows.$getRecord(s.seriesRef).seasons)};t.save(i,e)}function r(e){for(var t=o.objSize(e),n=1;n<=t;n++){seasonsSize=o.objSize(e["season_"+n]);for(var a=1;a<=seasonsSize;a++)e["season_"+n][a].watched=!1}return e}var s=this,i="rewatch/"+e.uid;s.rewatch=t.getByRef(i),s.shows=t.getByRef("shows"),s.add=a}function episodateApi(e,t,n){function o(n){return e({method:"GET",url:"https://www.episodate.com/api/show-details?q="+n}).then(function(e){return 0!==t.objSize(e.data.tvShow.episodes)&&a(e.data.tvShow)})}function a(e){var n=e.episodes,o={},a=t.objSize(n)-1,r=1,s=1,i=0,c={};for(c.seasons=[],c.series=e.name,c.imgSrc=e.image_path,c.imgSrcSm=e.image_thumbnail_path,c.status=e.status,o["season_"+r]={},i;i<a&&(o["season_"+r][s]={name:n[i].name,number:n[i].episode,airDate:t.dateToMs(n[i].air_date)},!(i>a-1));i++)n[i+1].season===r?s++:(s=1,r++,o["season_"+r]={}),c.seasons=o;return c}return{getShow:o}}function firebaseArray(e){function t(t,n){var t=firebase.database().ref(t);return e(t).$add(n)}function n(t){var t=firebase.database().ref(t);return e(t)}return{save:t,getByRef:n}}function firebaseAuth(e){return e()}function helperFunctions(){function e(e){var t=0;for(var n in e){if(!e.hasOwnProperty(n))break;++t}return t}function t(e){return e.replace(/\s+/g,"-")}function n(e){return new Date(e).getTime()}return{objSize:e,spacesToDashes:t,dateToMs:n}}function ShowsController(e,t,n,o){function a(){var a=r.series;r.series&&(r.sendStatus.disableButton=!0,r.sendStatus.loader=!0,a=n.spacesToDashes(a),t.getShow(a).then(function(t){o(function(){t.seasons&&(e.save("shows",t),r.series=""),r.sendStatus.disableButton=!1,r.sendStatus.loader=!1},2e3)}))}var r=this;r.shows=e.getByRef("shows"),r.add=a,r.sendStatus={disableButton:!1,loader:!1}}function SigninController(e,t){function n(){a.email,a.password;e.$signInWithEmailAndPassword(a.email,a.password).then(function(e){t.go("shows")}).catch(function(e){console.log(e)})}function o(){a.email,a.password;e.$createUserWithEmailAndPassword(a.email,a.password).then(function(e){t.go("shows")}).catch(function(e){console.log(e)})}var a=this;a.login=n,a.signup=o}function WatchlistController(e,t,n,o,a){function r(){var e={upToDate:!1,showId:u.seriesRef,on:{season:u.season,episode:u.episode},unwatched:{}};e.unwatched=s(e),console.log(e),t.save(l,e)}function s(e){var t={},n=u.shows.$getRecord(e.showId),a=o.objSize(n.seasons),r=parseInt(e.on.episode),s=parseInt(e.on.season),i=s;o.objSize(n.seasons["season_"+s]);for(i;i<=a;i++){seasonsSize=o.objSize(n.seasons["season_"+i]),t["season_"+i]=n.seasons["season_"+i],t["season_"+i][0]=i;for(var c=1;c<=seasonsSize;c++)t["season_"+i][c].watched=!1,c<r&&i==s&&(t["season_"+i][c].watched=!0)}return t}function i(e){var t,n=1,a=1,r={},s=u.shows.$getRecord(e.showId),i=o.objSize(s.seasons),c=s.seasons["season_"+i],l=o.objSize(c),h=parseInt(e.on.episode);parseInt(e.on.season);for(a;a<=l;a++)r[a]={watched:!1,airDate:c[a].airDate},a<h&&(r[a].watched=!0);for(n;n<=l;n++)if(r[n].aired=!0,c[n].airDate-d>0){r[n].aired=!1,t=c[n].airDate;break}return{unwatched:r,nextAired:t}}function c(e){return(e=parseInt(e))-d<0}var u=this,l="watchlist/"+e.uid,d=(new Date).getTime();u.watchlist=t.getByRef(l),u.shows=t.getByRef("shows"),u.add=r,u.nextAired=i,u.checkAired=c}angular.module("app").directive("countdownTimer",countdownTimer),countdownTimer.$inject=["$interval","helperFunctions"],angular.module("app").directive("countdownCard",countdownCard),angular.module("app").directive("frostGlass",frostGlass),angular.module("app").controller("NavigationBarController",NavigationBarController),NavigationBarController.$inject=["firebaseAuth","$state"],angular.module("app").directive("navigationBar",navigationBar),angular.module("app").directive("rewatchCard",rewatchCard),angular.module("app").directive("seasonInfo",seasonInfo),angular.module("app").directive("seasonTabs",seasonTabs),angular.module("app").directive("showsCountdownCard",showsCountdownCard),angular.module("app").directive("watchlistCard",watchlistCard),angular.module("app",["ui.router","firebase"]),angular.module("app").config(config),config.$inject=["$stateProvider","$urlRouterProvider"],angular.module("app").run(runBlock),runBlock.$inject=["$rootScope","$state"],angular.module("app").controller("RewatchController",RewatchController),RewatchController.$inject=["currentAuth","firebaseArray","$timeout","helperFunctions"],angular.module("app").service("episodateApi",episodateApi),episodateApi.$inject=["$http","helperFunctions","$timeout"],angular.module("app").factory("firebaseArray",firebaseArray),firebaseArray.$inject=["$firebaseArray"],angular.module("app").factory("firebaseAuth",firebaseAuth),firebaseAuth.$inject=["$firebaseAuth"];var config={apiKey:"AIzaSyBThnFs67ZrJ6J0z6IXkGzT16077IGXk9c",authDomain:"towatch-b9155.firebaseapp.com",databaseURL:"https://towatch-b9155.firebaseio.com",projectId:"towatch-b9155",storageBucket:"towatch-b9155.appspot.com",messagingSenderId:"989986376535"};firebase.initializeApp(config),angular.module("app").factory("helperFunctions",helperFunctions),angular.module("app").controller("ShowsController",ShowsController),ShowsController.$inject=["firebaseArray","episodateApi","helperFunctions","$timeout"],angular.module("app").controller("SigninController",SigninController),SigninController.$inject=["firebaseAuth","$state"],angular.module("app").controller("WatchlistController",WatchlistController),WatchlistController.$inject=["currentAuth","firebaseArray","$timeout","helperFunctions","episodateApi"];