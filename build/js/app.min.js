function countdownCard(){return{templateUrl:"components/countdown-card/countdown-card.html",restrict:"E",transclude:!0,scope:{heading:"=",subheading:"=",imgsrc:"=",visible:"="}}}function countdownTimer(e,t){function n(t,n){function o(e,t){var n=Math.abs(e-t);if(e-t<0||!e)return[0,0,0,0];var o=Math.floor(n/a.day);n-=o*a.day;var r=Math.floor(n/a.hour)%a.hour;n-=r*a.hour;var i=Math.floor(n/a.minute)%a.hour;return n-=i*a.minute,[o,r,i,Math.floor(n)]}function r(e){var t={},n=["day","hour","min","sec"],o=0;for(o;o<4;o++)t[n[o].charAt(0)]={name:n[o],val:"0"+e[o]},e[o]>1&&e[o]<10&&(t[n[o].charAt(0)]={name:n[o]+"s",val:"0"+e[o]}),e[o]>9&&(t[n[o].charAt(0)]={name:n[o]+"s",val:""+e[o]});return t}var a={now:function(){return(new Date).getTime()/1e3},future:t.to/1e3,day:86400,hour:3600,minute:60};e(function(){t.counter=r(o(a.future,a.now()))},1e3)}return{link:n,templateUrl:"components/countdown-timer/countdown-timer.html",restrict:"E",scope:{to:"="}}}function NavigationBarController(e,t){function n(){"close"==close&&(a.open=!1),a.open=!a.open}function o(){return e.$getAuth()}function r(){e.$signOut(),t.go("home")}var a=this;a.open=!1,a.toggleOpen=n,a.userSignedIn=o,a.logout=r}function navigationBar(){return{templateUrl:"components/navigation-bar/navigation-bar.html",restrict:"E",controller:"NavigationBarController",controllerAs:"NavbarCtrl"}}function rewatchCard(){return{templateUrl:"components/rewatch-card/rewatch-card.html",restrict:"E",transclude:!0,scope:{heading:"=",subheading:"=",details:"=",imgsrc:"=",visible:"="}}}function seasonInfo(){function e(e){function t(){e.open=!e.open}function n(t){e.tabActive=t}function o(t){return e.tabActive==t}function r(t,n,o,r){var a=parseInt(o.airDate),s=parseInt(t[n].on.episode),c=r===s||r===s-1&&e.tabActive.toString()==t[n].on.season;Math.abs(a-u)/1e3<0||!c||(o.watched=!o.watched,i(t[n].show,t,n),t.$save(n))}function a(e){return(e=parseInt(e))-u<0}function i(e,t,n){for(var o=(parseInt(t[n].on.episode),parseInt(t[n].on.season)),r="season_"+o,a=c(e[r]),i=0,s=1;s<=a;s++)1==e[r][s].watched&&i++,i==a&&(o++,i=0);t[n].on.episode=(i+1).toString(),t[n].on.season=o.toString()}function s(e,t){return e.length>t?e.substring(0,t)+"...":e}function c(e){var t=0;for(var n in e)e.hasOwnProperty(n)&&++t;return t}var u=(new Date).getTime();e.open=!1,e.toggleOpen=t,e.tabActive=e.currentseason,e.tabSelect=n,e.isTabSelected=o,e.save=r,e.hasAired=a,e.currentSeason=i,e.limitLength=s}return{link:e,templateUrl:"components/season-info/season-info.html",restrict:"E",scope:{seasons:"=",currentseason:"=",rewatchobj:"=",index:"="}}}function showsCountdownCard(){function e(e){function t(){e.open=!e.open}function n(e,t,n,o,i){var s=parseInt(o.airDate),c=parseInt(e[t].on.episode),u=i==c||i==c-1;Math.abs(s-a)/1e3<0||!u||(o.watched=!o.watched,r(n,e,t),e.$save(t))}function o(e){if(e){e=parseInt(e);var t=Math.abs(e-a)/1e3,n={aired:e-a+21600<0};return n.by=e-a+21600>0?"not aired":"-"+Math.ceil(t/86400)+" days",n}}function r(e,t,n){var o=1,r=e.length-1,a=parseInt(t[n].on.season)+1,i=void 0==t[n].on.season["season_"+a];for(o;o<=r&&e[o].watched;o++);o>r&&(i?t[n].upToDate=!0:(t[n].on.season=a,t[n].on.episode=1)),t[n].on.episode=o}var a=(new Date).getTime();e.open=!1,e.upToDate=!1,e.toggleOpen=t,e.save=n,e.aired=o,e.countWatched=r}return{link:e,templateUrl:"components/shows-countdown-card/shows-countdown-card.html",restrict:"E",transclude:!0,scope:{heading:"=",subheading:"=",details:"=",imgsrc:"=",seasoninfo:"=",visible:"=",watchlistobj:"=",index:"="}}}function sideNavigation(){return{templateUrl:"js/components/side-navigation/side-navigation.html",restrict:"E"}}function config(e,t){e.state("home",{url:"/home",templateUrl:"home/home.html",resolve:{currentAuth:["firebaseAuth",function(e){return e.$waitForSignIn()}]}}).state("signin",{url:"/signin",templateUrl:"signin/sign.html",controller:"SigninController",controllerAs:"SigninCtrl"}).state("watchlist",{url:"/watchlist",templateUrl:"watchlist/watchlist.html",controller:"WatchlistController",controllerAs:"WatchlistCtrl",resolve:{currentAuth:["firebaseAuth",function(e){return e.$requireSignIn()}]}}).state("rewatch",{url:"/rewatch",templateUrl:"rewatchlist/rewatch.html",controller:"RewatchController",controllerAs:"RewatchCtrl",resolve:{currentAuth:["firebaseAuth",function(e){return e.$requireSignIn()}]}}).state("shows",{url:"/shows",templateUrl:"shows/shows.html",controller:"ShowsController",controllerAs:"ShowsCtrl",resolve:{currentAuth:["firebaseAuth",function(e){return e.$requireSignIn()}]}}),t.otherwise("home")}function runBlock(e,t){e.$on("$stateChangeError",function(e,n,o,r,a,i){"AUTH_REQUIRED"===i&&t.go("signin")})}function RewatchController(e,t,n,o){function r(){var e={showId:i.seriesRef,on:{season:"1",episode:"1"},show:a(i.shows.$getRecord(i.seriesRef).seasons)};t.save(s,e)}function a(e){for(var t=o.objSize(e),n=1;n<=t;n++){seasonsSize=o.objSize(e["season_"+n]);for(var r=1;r<=seasonsSize;r++)e["season_"+n][r].watched=!1}return e}var i=this,s="rewatch/"+e.uid;i.rewatch=t.getByRef(s),i.shows=t.getByRef("shows"),i.add=r}function episodateApi(e,t,n){function o(n){return e({method:"GET",url:"https://www.episodate.com/api/show-details?q="+n}).then(function(e){return 0!==t.objSize(e.data.tvShow.episodes)&&r(e.data.tvShow)})}function r(e){var n=e.episodes,o={},r=t.objSize(n)-1,a=1,i=1,s=0,c={};for(c.seasons=[],c.series=e.name,c.imgSrc=e.image_path,c.imgSrcSm=e.image_thumbnail_path,c.status=e.status,o["season_"+a]={},s;s<r&&(o["season_"+a][i]={name:n[s].name,number:n[s].episode,airDate:t.dateToMs(n[s].air_date)},!(s>r-1));s++)n[s+1].season===a?i++:(i=1,a++,o["season_"+a]={}),c.seasons=o;return c}return{getShow:o}}function firebaseArray(e){function t(t,n){var t=firebase.database().ref(t);return e(t).$add(n)}function n(t){var t=firebase.database().ref(t);return e(t)}return{save:t,getByRef:n}}function firebaseAuth(e){return e()}function helperFunctions(){function e(e){var t=0;for(var n in e){if(!e.hasOwnProperty(n))break;++t}return t}function t(e){return e.replace(/\s+/g,"-")}function n(e){return new Date(e).getTime()}return{objSize:e,spacesToDashes:t,dateToMs:n}}function ShowsController(e,t,n,o){function r(){var r=a.series;a.series&&(a.sendStatus.disableButton=!0,a.sendStatus.loader=!0,r=n.spacesToDashes(r),t.getShow(r).then(function(t){o(function(){t.seasons&&(e.save("shows",t),a.series=""),a.sendStatus.disableButton=!1,a.sendStatus.loader=!1},2e3)}))}var a=this;a.shows=e.getByRef("shows"),a.add=r,a.sendStatus={disableButton:!1,loader:!1}}function SigninController(e,t){function n(){r.email,r.password;e.$signInWithEmailAndPassword(r.email,r.password).then(function(e){t.go("shows")}).catch(function(e){console.log(e)})}function o(){r.email,r.password;e.$createUserWithEmailAndPassword(r.email,r.password).then(function(e){t.go("shows")}).catch(function(e){console.log(e)})}var r=this;r.login=n,r.signup=o}function WatchlistController(e,t,n,o,r){function a(){var e={upToDate:!1,showId:c.seriesRef,on:{season:c.season,episode:c.episode},unwatched:{}};e.unwatched=i(e).unwatched,t.save(u,e)}function i(e){var t,n=1,r=1,a={},i=c.shows.$getRecord(e.showId),s=o.objSize(i.seasons),u=i.seasons["season_"+s],h=o.objSize(u),d=parseInt(e.on.episode);for(r;r<=h;r++)a[r]={watched:!1,airDate:u[r].airDate},r<d&&(a[r].watched=!0);for(n;n<=h;n++)if(a[n].aired=!0,u[n].airDate-l>0){a[n].aired=!1,t=u[n].airDate;break}return{unwatched:a,nextAired:t}}function s(e){return e-l<0}var c=this,u="watchlist/"+e.uid,l=(new Date).getTime();c.watchlist=t.getByRef(u),c.shows=t.getByRef("shows"),c.add=a,c.nextAired=i,c.checkAired=s}angular.module("app").directive("countdownCard",countdownCard),angular.module("app").directive("countdownTimer",countdownTimer),countdownTimer.$inject=["$interval","helperFunctions"],angular.module("app").controller("NavigationBarController",NavigationBarController),NavigationBarController.$inject=["firebaseAuth","$state"],angular.module("app").directive("navigationBar",navigationBar),angular.module("app").directive("rewatchCard",rewatchCard),angular.module("app").directive("seasonInfo",seasonInfo),angular.module("app").directive("showsCountdownCard",showsCountdownCard),angular.module("app").directive("sideNavigation",sideNavigation),angular.module("app",["ui.router","firebase"]),angular.module("app").config(config),config.$inject=["$stateProvider","$urlRouterProvider"],angular.module("app").run(runBlock),runBlock.$inject=["$rootScope","$state"],angular.module("app").controller("RewatchController",RewatchController),RewatchController.$inject=["currentAuth","firebaseArray","$timeout","helperFunctions"],angular.module("app").service("episodateApi",episodateApi),episodateApi.$inject=["$http","helperFunctions","$timeout"],angular.module("app").factory("firebaseArray",firebaseArray),firebaseArray.$inject=["$firebaseArray"],angular.module("app").factory("firebaseAuth",firebaseAuth),firebaseAuth.$inject=["$firebaseAuth"];var config={apiKey:"AIzaSyBThnFs67ZrJ6J0z6IXkGzT16077IGXk9c",authDomain:"towatch-b9155.firebaseapp.com",databaseURL:"https://towatch-b9155.firebaseio.com",projectId:"towatch-b9155",storageBucket:"towatch-b9155.appspot.com",messagingSenderId:"989986376535"};firebase.initializeApp(config),angular.module("app").factory("helperFunctions",helperFunctions),angular.module("app").controller("ShowsController",ShowsController),ShowsController.$inject=["firebaseArray","episodateApi","helperFunctions","$timeout"],angular.module("app").controller("SigninController",SigninController),SigninController.$inject=["firebaseAuth","$state"],angular.module("app").controller("WatchlistController",WatchlistController),WatchlistController.$inject=["currentAuth","firebaseArray","$timeout","helperFunctions","episodateApi"];