function countdownCard(){return{templateUrl:"js/components/countdown-card/countdown-card.html",restrict:"E",transclude:!0,scope:{heading:"=",subheading:"=",imgsrc:"=",visible:"="}}}function countdownTimer(e){function t(t,r){function n(e,t){var r=Math.abs(e-t);if(e-t<0||!e)return[0,0,0,0];var n=Math.floor(r/a.day);r-=n*a.day;var o=Math.floor(r/a.hour)%a.hour;r-=o*a.hour;var i=Math.floor(r/a.minute)%a.hour;return r-=i*a.minute,[n,o,i,Math.floor(r)]}function o(e){var t={},r=["day","hour","min","sec"],n=0;for(n;n<4;n++)t[r[n].charAt(0)]={name:r[n],val:"0"+e[n]},e[n]>1&&e[n]<10&&(t[r[n].charAt(0)]={name:r[n]+"s",val:"0"+e[n]}),e[n]>9&&(t[r[n].charAt(0)]={name:r[n]+"s",val:""+e[n]});return t}var a={now:function(){return(new Date).getTime()/1e3},future:parseInt(t.to)/1e3,day:86400,hour:3600,minute:60};e(function(){t.counter=o(n(a.future,a.now()))},1e3)}return{link:t,templateUrl:"js/components/countdown-timer/countdown-timer.html",restrict:"E",scope:{to:"="}}}function NavigationBarController(e,t){function r(){return e.$getAuth()}function n(){e.$signOut(),t.go("home")}var o=this;o.userSignedIn=r,o.logout=n}function navigationBar(){return{templateUrl:"js/components/navigation-bar/navigation-bar.html",restrict:"E",controller:"NavigationBarController",controllerAs:"NavbarCtrl"}}function seasonInfo(){function e(e){function t(){e.open=!e.open}function r(t){e.tabActive=t}function n(t){return e.tabActive==t}e.open=!1,e.toggleOpen=t,e.tabSelect=r,e.isTabSelected=n,e.tabActive=e.currentseason}return{link:e,templateUrl:"js/components/season-info/season-info.html",restrict:"E",scope:{seasons:"=",currentseason:"=",rewatchobj:"=",index:"="}}}function showsCountdownCard(){function e(e){function t(){e.open=!e.open}function r(e,t,r){airDate=parseInt(r.airDate),Math.abs(airDate-o)/1e3>0||(r.watched=!r.watched,e.$save(t))}function n(e){if(e){e=parseInt(e);var t=Math.abs(e-o)/1e3,r={aired:e-o<0};return r.by=e-o>0?"not aired":"-"+Math.floor(t/86400)+" days",r}}var o=(new Date).getTime();e.open=!1,e.toggleOpen=t,e.save=r,e.aired=n}return{link:e,templateUrl:"js/components/shows-countdown-card/shows-countdown-card.html",restrict:"E",transclude:!0,scope:{heading:"=",subheading:"=",imgsrc:"=",seasoninfo:"=",visible:"=",watchlistobj:"=",index:"="}}}function sideNavigation(){return{templateUrl:"js/components/side-navigation/side-navigation.html",restrict:"E"}}function RewatchCardController(e){function t(){r.open=!r.open}var r=this;r.open=!1,r.toggleOpen=t}function rewatchCard(){return{templateUrl:"js/components/rewatch-card/rewatch-card.html",restrict:"E",controller:"RewatchCardController",controllerAs:"RewatchCardCtrl",transclude:!0,scope:{heading:"=",subheading:"=",imgsrc:"="}}}function config(e,t){e.state("home",{url:"/home",templateUrl:"templates/home.html",resolve:{currentAuth:["firebaseAuth",function(e){return e.$waitForSignIn()}]}}).state("signin",{url:"/signin",templateUrl:"templates/sign.html",controller:"SigninController",controllerAs:"SigninCtrl"}).state("watchlist",{url:"/watchlist",templateUrl:"templates/watchlist.html",controller:"WatchlistController",controllerAs:"WatchlistCtrl",resolve:{currentAuth:["firebaseAuth",function(e){return e.$requireSignIn()}]}}).state("rewatch",{url:"/rewatch",templateUrl:"templates/rewatch.html",controller:"RewatchController",controllerAs:"RewatchCtrl",resolve:{currentAuth:["firebaseAuth",function(e){return e.$requireSignIn()}]}}).state("shows",{url:"/shows",templateUrl:"templates/shows.html",controller:"ShowsController",controllerAs:"ShowsCtrl",resolve:{currentAuth:["firebaseAuth",function(e){return e.$requireSignIn()}]}}),t.otherwise("home")}function runBlock(e,t){e.$on("$stateChangeError",function(e,r,n,o,a,i){"AUTH_REQUIRED"===i&&t.go("signin")})}function firebaseArray(e){function t(t,r){var t=firebase.database().ref(t);return e(t).$add(r)}function r(t){var t=firebase.database().ref(t);return e(t)}function n(){var t=firebase.database().ref();return e(t)}return{save:t,getByRef:r,getAll:n}}function firebaseAuth(e){return e()}function RewatchController(e,t,r){function n(){var e={init:!1,showId:s.seriesIndex,on:{s:"1",ep:"1"},show:o(s.shows[s.seriesIndex].seasons)};t.save(l,e)}function o(e){for(var t=a(e),r=1;r<=t;r++){seasonsSize=a(e["season_"+r]);for(var n=1;n<=seasonsSize;n++)e["season_"+r][n].watched=!1}return e}function a(e){var t=0;for(var r in e)e.hasOwnProperty(r)&&++t;return t}function i(e,t){for(var r=a(e),n=0,o=1,i=1;i<=r;i++){seasonsSize=a(e["season_"+i]);for(var l=1;l<=seasonsSize&&!1!==e["season_"+i][l].watched;l++)++n==seasonsSize&&o++}return s.rewatch[t].currentSeason=o,s.rewatch.$save(t),o}var s=this,l="rewatch/"+e.uid;s.rewatch=t.getByRef(l),s.shows=t.getByRef("shows"),s.add=n,s.currentSeason=i}function ShowsController(e,t){function r(){e.save("shows",gen)}var n=this;n.shows=e.getByRef("shows"),n.add=r}function SigninController(e,t){function r(){n.email,n.password;e.$signInWithEmailAndPassword(n.email,n.password).then(function(e){t.go("watchlist")}).catch(function(e){console.log(e)})}var n=this;n.login=r}function WatchlistController(e,t,r){function n(){var e={seriesId:l.series,on:{season:l.season,episode:l.episode},unwatched:{}};e.unwatched=a(e).unwatched,e["season_"+l.season]=[null,{watched:!1}],t.save(c,e)}function o(e){l.watchlist.$remove(e)}function a(e){var t,r=1,n=1,o={},a=l.shows[e.seriesId],i=s(a.seasons),c=a.seasons["season_"+i],h=s(c);for(n;n<=h;n++)o[n]={watched:!1,airDate:c[n].airDate};for(r;r<=h;r++)if(o[r].aired=!0,c[r].airDate-u>0){o[r].aired=!1,t=c[r].airDate;break}return{nextAired:t,unwatched:o}}function i(e){return e-u<0}function s(e){var t=0;for(var r in e){if(!e.hasOwnProperty(r))break;++t}return t}var l=this,c="watchlist/"+e.uid,u=(new Date).getTime();l.watchlist=t.getByRef(c),l.shows=t.getByRef("shows"),l.add=n,l.remove=o,l.nextAired=a,l.checkAired=i}angular.module("app").directive("countdownCard",countdownCard),angular.module("app").directive("countdownTimer",countdownTimer),countdownTimer.$inject=["$interval"],angular.module("app").controller("NavigationBarController",NavigationBarController),NavigationBarController.$inject=["firebaseAuth","$state"],angular.module("app").directive("navigationBar",navigationBar),angular.module("app").directive("seasonInfo",seasonInfo),angular.module("app").directive("showsCountdownCard",showsCountdownCard),angular.module("app").directive("sideNavigation",sideNavigation),angular.module("app").controller("RewatchCardController",RewatchCardController),RewatchCardController.$inject=["firebaseAuth"],angular.module("app").directive("rewatchCard",rewatchCard),angular.module("app",["ui.router","firebase"]),angular.module("app").config(config),config.$inject=["$stateProvider","$urlRouterProvider"],angular.module("app").run(runBlock),runBlock.$inject=["$rootScope","$state"];var config={apiKey:"AIzaSyBThnFs67ZrJ6J0z6IXkGzT16077IGXk9c",authDomain:"towatch-b9155.firebaseapp.com",databaseURL:"https://towatch-b9155.firebaseio.com",projectId:"towatch-b9155",storageBucket:"towatch-b9155.appspot.com",messagingSenderId:"989986376535"};firebase.initializeApp(config),angular.module("app").factory("firebaseArray",firebaseArray),firebaseArray.$inject=["$firebaseArray"],angular.module("app").factory("firebaseAuth",firebaseAuth),firebaseAuth.$inject=["$firebaseAuth"],angular.module("app").controller("RewatchController",RewatchController),RewatchController.$inject=["currentAuth","firebaseArray","$timeout"],angular.module("app").controller("ShowsController",ShowsController),ShowsController.$inject=["firebaseArray","$timeout"],angular.module("app").controller("SigninController",SigninController),SigninController.$inject=["firebaseAuth","$state"],angular.module("app").controller("WatchlistController",WatchlistController),WatchlistController.$inject=["currentAuth","firebaseArray","$timeout"];