function countdownCard(){return{templateUrl:"components/countdown-card/countdown-card.html",restrict:"E",transclude:!0,scope:{heading:"=",subheading:"=",imgsrc:"=",visible:"="}}}function countdownTimer(e,t){function n(t,n){function a(e,t){var n=Math.abs(e-t);if(e-t<0||!e)return[0,0,0,0];var a=Math.floor(n/r.day);n-=a*r.day;var o=Math.floor(n/r.hour)%r.hour;n-=o*r.hour;var s=Math.floor(n/r.minute)%r.hour;return n-=s*r.minute,[a,o,s,Math.floor(n)]}function o(e){var t={},n=["day","hour","min","sec"],a=0;for(a;a<4;a++)t[n[a].charAt(0)]={name:n[a],val:"0"+e[a]},e[a]>1&&e[a]<10&&(t[n[a].charAt(0)]={name:n[a]+"s",val:"0"+e[a]}),e[a]>9&&(t[n[a].charAt(0)]={name:n[a]+"s",val:""+e[a]});return t}var r={now:function(){return(new Date).getTime()/1e3},future:t.to/1e3,day:86400,hour:3600,minute:60};e(function(){t.counter=o(a(r.future,r.now()))},1e3)}return{link:n,templateUrl:"components/countdown-timer/countdown-timer.html",restrict:"E",scope:{to:"="}}}function frostGlass(e){return{templateUrl:"components/frost-glass/frost-glass.html",restrict:"E",transclude:!0,scope:{imgsrc:"="}}}function moreButton(e){function t(e){function t(e){var t=1,n=e.length-1,a=0;for(t;t<=n;t++)!e[t].watched&&e[t].airDate-now<0&&a++;return a>0?"-"+a:a}console.log(e),e.behindCount=t}return{link:t,templateUrl:"components/more-button/more-button.html",restrict:"E",scope:{seasons:"=",action:"&"}}}function NavigationBarController(e,t){function n(){"close"==close&&(r.open=!1),r.open=!r.open}function a(){return e.$getAuth()}function o(){e.$signOut(),t.go("home")}var r=this;r.open=!1,r.toggleOpen=n,r.userSignedIn=a,r.logout=o}function navigationBar(){return{templateUrl:"components/navigation-bar/navigation-bar.html",restrict:"E",controller:"NavigationBarController",controllerAs:"NavbarCtrl"}}function rewatchCard(){return{templateUrl:"components/rewatch-card/rewatch-card.html",restrict:"E",transclude:!0,scope:{heading:"=",subheading:"=",details:"=",imgsrc:"=",visible:"="}}}function seasonInfo(e){function t(t){function n(){t.open=!t.open}function a(e){t.tabActive=e}function o(e){return t.tabActive==e}function r(e,n,a,o){var r=parseInt(a.airDate),s=parseInt(e[n].on.episode),c=o===s||o===s-1&&t.tabActive.toString()==e[n].on.season;Math.abs(r-u)/1e3<0||!c||(a.watched=!a.watched,i(e[n].show,e,n),e.$save(n))}function s(e){return(e=parseInt(e))-u<0}function i(t,n,a){for(var o=(parseInt(n[a].on.episode),parseInt(n[a].on.season)),r="season_"+o,s=e.objSize(t[r]),i=0,c=1;c<=s;c++)1==t[r][c].watched&&i++,i==s&&(o++,i=0);n[a].on.episode=(i+1).toString(),n[a].on.season=o.toString()}function c(e,t){return e.length>t?e.substring(0,t)+"...":e}var u=(new Date).getTime();t.open=!1,t.deleteOpen=!1,t.toggleOpen=n,t.tabActive=t.currentseason,t.tabSelect=a,t.isTabSelected=o,t.save=r,t.hasAired=s,t.currentSeason=i,t.limitLength=c}return{link:t,templateUrl:"components/season-info/season-info.html",restrict:"E",scope:{seasons:"=",currentseason:"=",rewatchobj:"=",index:"="}}}function seasonTabs(e){function t(t){function n(){t.open=!t.open}function a(e){t.tabActive=e}function o(e){return t.tabActive==e}function r(e,n,a,o){var r=parseInt(a.airDate),s=parseInt(e[n].on.episode),c=o===s||o===s-1&&t.tabActive.toString()==e[n].on.season;Math.abs(r-u)/1e3<0||!c||(a.watched=!a.watched,i(e[n].show,e,n),e.$save(n))}function s(e){return(e=parseInt(e))-u<0}function i(t,n,a){for(var o=(parseInt(n[a].on.episode),parseInt(n[a].on.season)),r="season_"+o,s=e.objSize(t[r]),i=0,c=1;c<=s;c++)1==t[r][c].watched&&i++,i==s&&(o++,i=0);n[a].on.episode=(i+1).toString(),n[a].on.season=o.toString()}function c(e,t){return e.length>t?e.substring(0,t)+"...":e}var u=(new Date).getTime();t.open=!1,t.deleteOpen=!1,t.toggleOpen=n,t.tabActive=t.currentseason,t.tabSelect=a,t.isTabSelected=o,t.save=r,t.hasAired=s,t.currentSeason=i,t.limitLength=c}return{link:t,templateUrl:"components/season-tabs/season-tabs.html",restrict:"E",scope:{open:"=",seasons:"=",currentseason:"=",rewatchobj:"=",index:"="}}}function showsCountdownCard(){function e(e){function t(){e.open=!e.open}function n(e,t,n,a,r){var i=parseInt(a.airDate),c=parseInt(e[t].on.episode),u=r==c||r==c-1;Math.abs(i-s)/1e3<0||!u||(a.watched=!a.watched,o(n,e,t),e.$save(t))}function a(e){if(e){e=parseInt(e);var t=Math.abs(e-s)/1e3,n={aired:e-s<0};return e-s<0?(n.by="-"+Math.ceil(t/86400)+" days",Math.ceil(t/86400)>30&&(n.by="aired")):n.by="not aired",n}}function o(e,t,n){var a=1,o=e.length-1,r=parseInt(t[n].on.season)+1,s=void 0==t[n].on.season["season_"+r];for(a;a<=o&&e[a].watched;a++);a>o&&(s?t[n].upToDate=!0:(t[n].on.season=r,t[n].on.episode=1)),t[n].on.episode=a}function r(e){var t=1,n=e.length-1,a=0;for(t;t<=n;t++)!e[t].watched&&e[t].airDate-s<0&&a++;return a>0?"-"+a:a}var s=(new Date).getTime();e.deleteOpen=!1,e.open=!1,e.upToDate=!1,e.toggleOpen=t,e.save=n,e.aired=a,e.countWatched=o,e.behindCount=r}return{link:e,templateUrl:"components/shows-countdown-card/shows-countdown-card.html",restrict:"E",transclude:!0,scope:{heading:"=",subheading:"=",details:"=",imgsrc:"=",seasoninfo:"=",visible:"=",watchlistobj:"=",index:"="}}}function watchlistCard(){function e(e){function t(){e.open=!e.open}function n(e,t,n,a,s){var i=parseInt(a.airDate),c=parseInt(e[t].on.episode),u=s==c||s==c-1;Math.abs(i-r)/1e3<0||!u||(a.watched=!a.watched,o(n,e,t),e.$save(t))}function a(e){if(e){e=parseInt(e);var t=Math.abs(e-r)/1e3,n={aired:e-r<0};return e-r<0?(n.by="-"+Math.ceil(t/86400)+" days",Math.ceil(t/86400)>30&&(n.by="aired")):n.by="not aired",n}}function o(e,t,n){var a=1,o=e.length-1,r=parseInt(t[n].on.season)+1,s=void 0==t[n].on.season["season_"+r];for(a;a<=o&&e[a].watched;a++);a>o&&(s?t[n].upToDate=!0:(t[n].on.season=r,t[n].on.episode=1)),t[n].on.episode=a}var r=(new Date).getTime();e.deleteOpen=!1,e.open=!1,e.upToDate=!1,e.toggleOpen=t,e.save=n,e.aired=a,e.countWatched=o}return{link:e,templateUrl:"components/watchlist-card/watchlist-card.html",restrict:"E",controller:"WatchlistCardController",controllerAs:"WatchlistCardCtrl",transclude:{button:"moreButton",tabs:"seasonTabs",frostGlass:"frostGlass"},scope:{heading:"=",subheading:"=",details:"=",imgsrc:"=",watchlistobj:"=",index:"="}}}function WatchlistCardController(){function e(){console.log("click"),scope.open=!scope.open}var t=this;t.open=!1,t.toggleOpen=e}function config(e,t){e.state("home",{url:"/home",templateUrl:"home/home.html",resolve:{currentAuth:["firebaseAuth",function(e){return e.$waitForSignIn()}]}}).state("signin",{url:"/signin",templateUrl:"signin/sign.html",controller:"SigninController",controllerAs:"SigninCtrl"}).state("watchlist",{url:"/watchlist",templateUrl:"watchlist/watchlist.html",controller:"WatchlistController",controllerAs:"WatchlistCtrl",resolve:{currentAuth:["firebaseAuth",function(e){return e.$requireSignIn()}]}}).state("rewatch",{url:"/rewatch",templateUrl:"rewatchlist/rewatch.html",controller:"RewatchController",controllerAs:"RewatchCtrl",resolve:{currentAuth:["firebaseAuth",function(e){return e.$requireSignIn()}]}}).state("shows",{url:"/shows",templateUrl:"shows/shows.html",controller:"ShowsController",controllerAs:"ShowsCtrl",resolve:{currentAuth:["firebaseAuth",function(e){return e.$requireSignIn()}]}}),t.otherwise("home")}function runBlock(e,t){e.$on("$stateChangeError",function(e,n,a,o,r,s){"AUTH_REQUIRED"===s&&t.go("signin")})}function RewatchController(e,t,n,a){function o(){var e={showId:s.seriesRef,on:{season:"1",episode:"1"},show:r(s.shows.$getRecord(s.seriesRef).seasons)};t.save(i,e)}function r(e){for(var t=a.objSize(e),n=1;n<=t;n++){seasonsSize=a.objSize(e["season_"+n]);for(var o=1;o<=seasonsSize;o++)e["season_"+n][o].watched=!1}return e}var s=this,i="rewatch/"+e.uid;s.rewatch=t.getByRef(i),s.shows=t.getByRef("shows"),s.add=o}function episodateApi(e,t,n){function a(n){return e({method:"GET",url:"https://www.episodate.com/api/show-details?q="+n}).then(function(e){return 0!==t.objSize(e.data.tvShow.episodes)&&o(e.data.tvShow)})}function o(e){var n=e.episodes,a={},o=t.objSize(n)-1,r=1,s=1,i=0,c={};for(c.seasons=[],c.series=e.name,c.imgSrc=e.image_path,c.imgSrcSm=e.image_thumbnail_path,c.status=e.status,a["season_"+r]={},i;i<o&&(a["season_"+r][s]={name:n[i].name,number:n[i].episode,airDate:t.dateToMs(n[i].air_date)},!(i>o-1));i++)n[i+1].season===r?s++:(s=1,r++,a["season_"+r]={}),c.seasons=a;return c}return{getShow:a}}function firebaseArray(e){function t(t,n){var t=firebase.database().ref(t);return e(t).$add(n)}function n(t){var t=firebase.database().ref(t);return e(t)}return{save:t,getByRef:n}}function firebaseAuth(e){return e()}function helperFunctions(){function e(e){var t=0;for(var n in e){if(!e.hasOwnProperty(n))break;++t}return t}function t(e){return e.replace(/\s+/g,"-")}function n(e){return new Date(e).getTime()}return{objSize:e,spacesToDashes:t,dateToMs:n}}function ShowsController(e,t,n,a){function o(){var o=r.series;r.series&&(r.sendStatus.disableButton=!0,r.sendStatus.loader=!0,o=n.spacesToDashes(o),t.getShow(o).then(function(t){a(function(){t.seasons&&(e.save("shows",t),r.series=""),r.sendStatus.disableButton=!1,r.sendStatus.loader=!1},2e3)}))}var r=this;r.shows=e.getByRef("shows"),r.add=o,r.sendStatus={disableButton:!1,loader:!1}}function SigninController(e,t){function n(){o.email,o.password;e.$signInWithEmailAndPassword(o.email,o.password).then(function(e){t.go("shows")}).catch(function(e){console.log(e)})}function a(){o.email,o.password;e.$createUserWithEmailAndPassword(o.email,o.password).then(function(e){t.go("shows")}).catch(function(e){console.log(e)})}var o=this;o.login=n,o.signup=a}function WatchlistController(e,t,n,a,o){function r(){var e={upToDate:!1,showId:u.seriesRef,on:{season:u.season,episode:u.episode},unwatched:{}};e.unwatched=s(e)}function s(e){var t={},n=u.shows.$getRecord(e.showId),o=a.objSize(n.seasons),r=parseInt(e.on.episode),s=parseInt(e.on.season);a.objSize(n.seasons["season_"+s]);for(s;s<=o;s++){seasonsSize=a.objSize(n.seasons["season_"+s]),t["season_"+s]=n.seasons["season_"+s];for(var i=1;i<=seasonsSize;i++)t["season_"+s][i].watched=!1,i<r&&(t["season_"+s][i].watched=!0)}return t}function i(e){var t,n=1,o=1,r={},s=u.shows.$getRecord(e.showId),i=a.objSize(s.seasons),c=s.seasons["season_"+i],l=a.objSize(c),d=parseInt(e.on.episode);parseInt(e.on.season);for(o;o<=l;o++)r[o]={watched:!1,airDate:c[o].airDate},o<d&&(r[o].watched=!0);for(n;n<=l;n++)if(r[n].aired=!0,c[n].airDate-h>0){r[n].aired=!1,t=c[n].airDate;break}return{unwatched:r,nextAired:t}}function c(e){return(e=parseInt(e))-h<0}var u=this,l="watchlist/"+e.uid,h=(new Date).getTime();u.watchlist=t.getByRef(l),u.shows=t.getByRef("shows"),u.add=r,u.nextAired=i,u.checkAired=c,u.gened={upToDate:!1,showId:"-KqOp94MY8Uv8uky7I8N",on:{season:"3",episode:"9"},unwatched:{season_3:[null,{airDate:1472418e6,name:"New York Strong",number:1,watched:!0},{airDate:14730228e5,name:"Bad White",number:2,watched:!0},{airDate:14736276e5,name:"First Born",number:3,watched:!0},{airDate:14742324e5,name:"Gone But Not Forgotten",number:4,watched:!0},{airDate:14748372e5,name:"Madness",number:5,watched:!0},{airDate:1475442e6,name:"The Battle of Central Park",number:6,watched:!0},{airDate:14760468e5,name:"Collaborators",number:7,watched:!0},{airDate:14766516e5,name:"White Light",number:8,watched:!0},{airDate:14772564e5,name:"Do or Die",number:9,watched:!1},{airDate:14778648e5,name:"The Fall",number:10,watched:!1}],season_4:[null,{airDate:15002388e5,name:"The Worm Turns",number:1,watched:!0},{airDate:15008436e5,name:"The Blood Tax",number:2,watched:!0},{airDate:15014484e5,name:"One Shot",number:3,watched:!0},{airDate:15020532e5,name:"New Horizons",number:4,watched:!0},{airDate:1502658e6,name:"Belly of the Beast",number:5,watched:!0},{airDate:15032628e5,name:"Tainted Love",number:6,watched:!0},{airDate:15038676e5,name:"Ouroboros",number:7,watched:!0},{airDate:15044724e5,name:"Extraction",number:8,watched:!0},{airDate:15050772e5,name:"The Traitor",number:9,watched:!1}]}}}angular.module("app").directive("countdownCard",countdownCard),angular.module("app").directive("countdownTimer",countdownTimer),countdownTimer.$inject=["$interval","helperFunctions"],angular.module("app").directive("frostGlass",frostGlass),angular.module("app").directive("moreButton",moreButton),angular.module("app").controller("NavigationBarController",NavigationBarController),NavigationBarController.$inject=["firebaseAuth","$state"],angular.module("app").directive("navigationBar",navigationBar),angular.module("app").directive("rewatchCard",rewatchCard),angular.module("app").directive("seasonInfo",seasonInfo),angular.module("app").directive("seasonTabs",seasonTabs),angular.module("app").directive("showsCountdownCard",showsCountdownCard),angular.module("app").directive("watchlistCard",watchlistCard),angular.module("app").controller("WatchlistCardController",WatchlistCardController),angular.module("app",["ui.router","firebase"]),angular.module("app").config(config),config.$inject=["$stateProvider","$urlRouterProvider"],angular.module("app").run(runBlock),runBlock.$inject=["$rootScope","$state"],angular.module("app").controller("RewatchController",RewatchController),RewatchController.$inject=["currentAuth","firebaseArray","$timeout","helperFunctions"],angular.module("app").service("episodateApi",episodateApi),episodateApi.$inject=["$http","helperFunctions","$timeout"],angular.module("app").factory("firebaseArray",firebaseArray),firebaseArray.$inject=["$firebaseArray"],angular.module("app").factory("firebaseAuth",firebaseAuth),firebaseAuth.$inject=["$firebaseAuth"];var config={apiKey:"AIzaSyBThnFs67ZrJ6J0z6IXkGzT16077IGXk9c",authDomain:"towatch-b9155.firebaseapp.com",databaseURL:"https://towatch-b9155.firebaseio.com",projectId:"towatch-b9155",storageBucket:"towatch-b9155.appspot.com",messagingSenderId:"989986376535"};firebase.initializeApp(config),angular.module("app").factory("helperFunctions",helperFunctions),angular.module("app").controller("ShowsController",ShowsController),ShowsController.$inject=["firebaseArray","episodateApi","helperFunctions","$timeout"],angular.module("app").controller("SigninController",SigninController),SigninController.$inject=["firebaseAuth","$state"],angular.module("app").controller("WatchlistController",WatchlistController),WatchlistController.$inject=["currentAuth","firebaseArray","$timeout","helperFunctions","episodateApi"];